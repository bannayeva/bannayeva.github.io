<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Page with Sidebar Navigation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            gap: 30px;
        }

        .main-content {
            flex: 1;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .sidebar {
            flex: 0 0 300px;
            background: transparent;
            padding: 20px;
            border-radius: 10px;
            box-shadow: none;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        #nav-tree-svg {
            width: 100%;
            height: 550px;
            background: transparent;
            display: block;
            margin: 0 auto;
            max-width: 100%;
            overflow: visible;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            #nav-tree-svg {
                height: 400px;
            }
        }

        @media (max-width: 480px) {
            #nav-tree-svg {
                height: 350px;
            }
        }
        
        .nav-link {
            fill: none;
            stroke: #764ba2;
            stroke-width: 2px;
            transition: all 0.3s ease;
        }
        
        .nav-link.highlighted {
            stroke: #333;
            stroke-width: 3px;
        }
        
        .nav-node {
            cursor: pointer;
        }
        
        .nav-join-node {
            font-size: 22px;
            font-weight: bold;
            fill: #764ba2;
            font-family: "Courier New", monospace;
        }

        .nav-leaf-node text {
            font-size: 14px;
            font-weight: 600;
            fill: #333;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .nav-leaf-node:hover text {
            fill: #764ba2;
        }

        /* Mobile responsive font sizes */
        @media (max-width: 768px) {
            .nav-join-node {
                font-size: 18px;
            }

            .nav-leaf-node text {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .nav-join-node {
                font-size: 16px;
            }

            .nav-leaf-node text {
                font-size: 11px;
            }
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .blog-post {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .blog-post h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .blog-post .date {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .blog-post p {
            line-height: 1.6;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <h1>Blog</h1>
            
            <div class="blog-post">
                <h2>Sample Blog Post 1</h2>
                <div class="date">December 15, 2024</div>
                <p>This is a sample blog post to demonstrate how the navigation tree appears in the sidebar. The main content area is now free from navigation elements, allowing blog posts to take center stage.</p>
            </div>

            <div class="blog-post">
                <h2>Sample Blog Post 2</h2>
                <div class="date">December 10, 2024</div>
                <p>Another sample blog post showing how the layout works with the navigation tree positioned in the sidebar. Users can easily navigate between different sections without the navigation interfering with the blog content.</p>
            </div>

            <div class="blog-post">
                <h2>Sample Blog Post 3</h2>
                <div class="date">December 5, 2024</div>
                <p>The navigation tree in the sidebar provides easy access to Home, CV, GitHub, Scholar, and Email links while keeping the main content area clean and focused on the blog posts.</p>
            </div>
        </div>

        <div class="sidebar">
            <svg id="navigation-tree-svg"></svg>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script>
        function createNavigationTree() {
            const treeData = {
            name: "⋈",
            type: "join",
            children: [
                {
                    name: "Home",
                    type: "leaf",
                    url: "/"
                },
                {
                    name: "⋈",
                    type: "join",
                    children: [
                        {
                            name: "Blog",
                            type: "leaf",
                            url: "/blog/"
                        },
                        {
                            name: "⋈",
                            type: "join",
                            children: [
                                {
                                    name: "CV",
                                    type: "leaf",
                                    url: "/files/cv.pdf",
                                    target: "_blank"
                                },
                                {
                                    name: "⋈",
                                    type: "join",
                                    children: [
                                        {
                                            name: "GitHub",
                                            type: "leaf",
                                            url: "https://github.com/bannayeva",
                                            target: "_blank"
                                        },
                                        {
                                            name: "⋈",
                                            type: "join",
                                            children: [
                                                {
                                                    name: "Scholar",
                                                    type: "leaf",
                                                    url: "https://scholar.google.com/citations?user=qyOolasAAAAJ&hl=en",
                                                    target: "_blank"
                                                },
                                                {
                                                    name: "Email",
                                                    type: "leaf",
                                                    url: "mailto:aliya.bannaeva@gmail.com"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        const margin = {top: 40, right: 60, bottom: 40, left: 20};
        const width = 450 - margin.left - margin.right;
        const height = 550 - margin.top - margin.bottom;

        const svg = d3.select("#navigation-tree-svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const treemap = d3.tree()
            .size([width, height * 0.8])
            .separation(() => 1);

        const root = d3.hierarchy(treeData);
        const treeNodes = treemap(root);

        const nodes = treeNodes.descendants();
        const edgeLength = 40;
        const horizontalSpacing = 50;

        // Position nodes responsively
        nodes.forEach(node => {
            if (node.depth === 0) {
                node.x = Math.max(margin.left + 20, Math.min(width * 0.3, margin.left + 80));
                node.y = Math.max(margin.top + 20, height * 0.25);
            } else if (node.depth === 1) {
                if (node.parent.children.indexOf(node) === 0) {
                    node.x = Math.max(margin.left + 10, node.parent.x - horizontalSpacing);
                } else {
                    node.x = Math.min(width - margin.right - 10, node.parent.x + horizontalSpacing);
                }
                node.y = node.parent.y + edgeLength;
            } else {
                if (node.parent.children && node.parent.children.length === 2) {
                    const index = node.parent.children.indexOf(node);
                    const offset = Math.min(horizontalSpacing / Math.pow(1.3, node.depth - 1), (width - margin.left - margin.right) / 8);
                    node.x = node.parent.x + (index === 0 ? -offset : offset);
                } else {
                    node.x = node.parent.x;
                }
                node.y = node.parent.y + edgeLength;
            }

            // Ensure nodes stay within bounds
            node.x = Math.max(margin.left + 10, Math.min(width - margin.right - 10, node.x));
            node.y = Math.max(margin.top + 10, Math.min(height - margin.bottom - 10, node.y));
        });

        const lastLevelNodes = nodes.filter(n => !n.children);
        const scholarNode = lastLevelNodes.find(n => n.data.name === "Scholar");
        const emailNode = lastLevelNodes.find(n => n.data.name === "Email");
        if (scholarNode && emailNode) {
            const parentX = scholarNode.parent.x;
            // Use the same horizontal spacing as other levels for consistency
            const baseSpacing = 35; // Match the horizontal spacing used in level positioning
            scholarNode.x = Math.max(margin.left + 10, parentX - baseSpacing);
            emailNode.x = Math.min(width - margin.right - 10, parentX + baseSpacing);

            // Ensure they stay within bounds
            scholarNode.x = Math.max(margin.left + 10, Math.min(width - margin.right - 10, scholarNode.x));
            emailNode.x = Math.max(margin.left + 10, Math.min(width - margin.right - 10, emailNode.x));
        }

        const links = treeNodes.links();

        const link = g.selectAll(".nav-link")
            .data(links)
            .enter().append("line")
            .attr("class", "nav-link")
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y + 10)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y - 10);

        const node = g.selectAll(".nav-node")
            .data(nodes)
            .enter().append("g")
            .attr("class", d => d.data.type === "join" ? "nav-node nav-join-node" : "nav-node nav-leaf-node")
            .attr("transform", d => `translate(${d.x},${d.y})`);

        node.filter(d => d.data.type === "join")
            .append("text")
            .attr("text-anchor", "middle")
            .attr("dy", "0.35em")
            .text(d => d.data.name);

        const leafNodes = node.filter(d => d.data.type === "leaf");

        leafNodes.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", d => d.children ? "-0.5em" : "0.35em")
            .text(d => d.data.name);

        leafNodes
            .style("cursor", "pointer")
            .on("click", (event, d) => {
                if (d.data.url) {
                    if (d.data.target === "_blank") {
                        window.open(d.data.url, "_blank");
                    } else {
                        window.location.href = d.data.url;
                    }
                }
            });

        leafNodes.on("mouseover", function(event, d) {
            const pathToRoot = [];
            let current = d;
            while (current.parent) {
                pathToRoot.push(current);
                current = current.parent;
            }
            
            link.classed("highlighted", l => {
                return pathToRoot.some(node => 
                    l.target === node || 
                    (l.source === node.parent && l.target === node)
                );
            });
        })
        .on("mouseout", function() {
            link.classed("highlighted", false);
        });

        link.style("opacity", 0)
            .transition()
            .duration(500)
            .delay((d, i) => i * 30)
            .style("opacity", 1);

        node.style("opacity", 0)
            .transition()
            .duration(500)
            .delay((d, i) => i * 20)
            .style("opacity", 1);
        }

        document.addEventListener('DOMContentLoaded', function() {
            createNavigationTree();

            // Add resize listener for responsive behavior
            let resizeTimeout;
            window.addEventListener('resize', function() {
                // Clear existing tree
                d3.select("#navigation-tree-svg").selectAll("*").remove();

                // Debounce resize events
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(createNavigationTree, 150);
            });
        });
    </script>
</body>
</html>
